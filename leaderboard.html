
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leaderboard</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
body{
  background:#0b0b0b;
  color:#fff;
  font-family:Arial, sans-serif;
  margin:0;
  padding:10px;
}
.header{
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:10px;
}
.stat{
  font-size:14px;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:6px;
  text-align:center;
  border-bottom:1px solid #222;
}
tr.rank-1{
  background:linear-gradient(90deg,#ffd700,#ffae00);
  color:#000;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="header">
  <div class="stat" id="poolValue">Jackpot: 0 SOMI</div>
  <div class="stat" id="topScoreValue">Top: 0</div>
</div>

<table>
<thead>
<tr>
  <th>#</th>
  <th>Player</th>
  <th>Score</th>
</tr>
</thead>
<tbody id="leaderboardBody"></tbody>
</table>

<script>
/* ===== CONFIG ===== */
const RPC_URL = "https://rpc.somnia.network";
const CONTRACT_ADDRESS = "PASTE_CONTRACT_ADDRESS";
const CONTRACT_ABI = [ /* ABI LEADERBOARD */ ];

/* ===== GLOBAL ===== */
let provider;
let gameContract;

/* ===== INIT ===== */
async function initLeaderboard(){
  provider = new ethers.providers.JsonRpcProvider(RPC_URL);
  gameContract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider);

  window._provider = provider;
  window._gameContract = gameContract;

  await fetchHeaderData();
  await fetchLeaderboard();
}

/* ===== HEADER ===== */
async function fetchHeaderData(){
  try{
    const jackpotWei = await gameContract.jackpotPool();
    const topScore = await gameContract.topScore();

    const jackpot = ethers.utils.formatEther(jackpotWei);

    document.getElementById("poolValue").textContent =
      "Jackpot: " + Number(jackpot).toFixed(6) + " SOMI";

    document.getElementById("topScoreValue").textContent =
      "Top: " + topScore.toString();

    window.parent?.postMessage({
      type:"leaderboardData",
      jackpot: jackpot,
      topScore: topScore.toString()
    },"*");

  }catch(e){}
}

/* ===== LEADERBOARD ===== */
async function fetchLeaderboard(){
  try{
    const rows = await gameContract.getLeaderboard();
    const tbody = document.getElementById("leaderboardBody");
    tbody.innerHTML="";

    rows.forEach((r,i)=>{
      const tr = tbody.insertRow();
      if(i===0) tr.classList.add("rank-1");

      tr.innerHTML=`
        <td>${i+1}</td>
        <td>${r.player.slice(0,6)}...${r.player.slice(-4)}</td>
        <td>${r.score}</td>
      `;
    });
  }catch(e){}
}

/* ===== AUTO REFRESH ===== */
setInterval(()=>{
  fetchHeaderData();
  fetchLeaderboard();
},10000);

initLeaderboard();
</script>

</body>
</html>
