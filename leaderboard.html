<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SOMNIA Leaderboard</title>

  <script src="libs/ethers.min.js"></script>

  <style>
    body {
      margin: 0;
      background: #0b0b0b;
      color: gold;
      font-family: Arial, sans-serif;
    }

    h2 {
      text-align: center;
      margin-top: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border-bottom: 1px solid #333;
      padding: 8px;
      text-align: center;
      font-size: 14px;
    }

    tr:hover {
      background: rgba(255, 215, 0, 0.1);
    }

    .loading {
      text-align: center;
      margin-top: 20px;
      font-size: 16px;
    }
  </style>
</head>

<body>

<h2>üèÜ SOMNIA LEADERBOARD</h2>
<div id="status" class="loading">Loading blockchain data...</div>

<table id="leaderboardTable" style="display:none">
  <thead>
    <tr>
      <th>No</th>
      <th>Wallet</th>
      <th>Total Score</th>
    </tr>
  </thead>
  <tbody id="leaderboardBody"></tbody>
</table>

<script>
/* ================================
   ‚úÖ CONFIG WAJIB
================================ */
const CONTRACT_ADDRESS = "0xD76b767102f2610b0C97FEE84873c1fAA4c7C365";

// ‚úÖ RPC PUBLIC SOMNIA (GANTI JIKA PERLU)
const RPC_URL = "https://rpc.somnia.network";

const CONTRACT_ABI = [
  "function getTopPlayers() view returns (address[] memory, uint256[] memory)"
];

/* ================================
   ‚úÖ INIT READ-ONLY PROVIDER
================================ */
const provider = new ethers.providers.JsonRpcProvider(RPC_URL);
const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider);

/* ================================
   ‚úÖ LOAD LEADERBOARD TANPA FLICKER
================================ */
async function loadLeaderboard() {
  try {
    const status = document.getElementById("status");
    const table = document.getElementById("leaderboardTable");
    const body  = document.getElementById("leaderboardBody");

    const result = await contract.getTopPlayers();
    const addrs  = result[0];
    const scores = result[1];

    body.innerHTML = "";

    for (let i = 0; i < addrs.length; i++) {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${addrs[i].slice(0, 6)}...${addrs[i].slice(-4)}</td>
        <td>${Number(scores[i])}</td>
      `;

      body.appendChild(tr);
    }

    status.style.display = "none";
    table.style.display = "table";

  } catch (err) {
    console.error("LEADERBOARD ERROR:", err);
    document.getElementById("status").innerText =
      "‚ùå Gagal terhubung ke blockchain leaderboard";
  }
}

// ‚úÖ Load 1x saja (TIDAK berkedip)
loadLeaderboard();
</script>

</body>
</html>
