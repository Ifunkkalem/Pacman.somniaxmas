<script src="./ethers.min.js"></script>

<script>
(async () => {

  const CONTRACT_ADDRESS = "0xD76b767102f2610b0C97FEE84873c1fAA4c7C365";

  const ABI = [
    {
      "inputs": [],
      "name": "getTop10",
      "outputs": [
        { "internalType": "address[]", "name": "topPlayers", "type": "address[]" },
        { "internalType": "uint256[]", "name": "scores", "type": "uint256[]" }
      ],
      "stateMutability": "view",
      "type": "function"
    }
  ];

  const list = document.getElementById("leaderboard-list");

  try {
    if (typeof ethers === "undefined") {
      list.innerHTML = "<li style='color:red'>ethers.js gagal dimuat</li>";
      return;
    }

    // ✅ RPC SOMNIA MAINNET (WAJIB)
    const provider = new ethers.providers.JsonRpcProvider(
      "https://rpc.somnia.network",
      {
        name: "somnia",
        chainId: 50312
      }
    );

    const contract = new ethers.Contract(
      CONTRACT_ADDRESS,
      ABI,
      provider
    );

    const result = await contract.getTop10();

    const players = result[0];
    const scores  = result[1];

    list.innerHTML = "";

    if (!players.length) {
      list.innerHTML = "<li>Belum ada skor</li>";
      return;
    }

    for (let i = 0; i < players.length; i++) {
      const li = document.createElement("li");
      li.innerText = `${i+1}. ${players[i]} — ${scores[i].toString()} PTS`;
      list.appendChild(li);
    }

  } catch (err) {
    console.error("LEADERBOARD ERROR:", err);
    list.innerHTML = "<li style='color:red'>RPC SOMNIA tidak merespons</li>";
  }

})();
</script>
