<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Leaderboard</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
body {
  margin: 0;
  padding: 12px;
  background: #000;
  color: #fff;
  font-family: Arial, sans-serif;
}
h2 { text-align: center; }
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  border-bottom: 1px solid #333;
  padding: 6px;
  text-align: center;
}
</style>
</head>

<body>

<h2>üèÜ Leaderboard</h2>

<div style="text-align:center;margin-bottom:10px;">
  Jackpot: <b id="jackpot">Loading...</b><br/>
  Top Score: <b id="topScore">-</b>
</div>

<table>
<thead>
<tr>
<th>#</th>
<th>Player</th>
<th>Score</th>
</tr>
</thead>
<tbody id="leaderRows">
<tr><td colspan="3">Loading...</td></tr>
</tbody>
</table>

<script>
const CONTRACT_ADDRESS = "0x35a7f3eE9A2b5fdEE717099F9253Ae90e1248AE3";
const ABI = [
  "function jackpotPool() view returns(uint256)",
  "function getTopScores() view returns(address[] memory, uint256[] memory)"
];

const provider = new ethers.providers.JsonRpcProvider(
  "https://somnia-rpc.publicnode.com"
);

const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);

async function loadLeaderboard() {
  try {
    const jackpotWei = await contract.jackpotPool();
    const jackpot = ethers.utils.formatEther(jackpotWei);

    const [players, scores] = await contract.getTopScores();

    // Jackpot & Top
    document.getElementById("jackpot").innerText =
      parseFloat(jackpot).toFixed(6) + " SOMI";

    const top = scores.length ? scores[0].toString() : "0";
    document.getElementById("topScore").innerText = top;

    // Rows
    const tbody = document.getElementById("leaderRows");
    tbody.innerHTML = "";

    players.forEach((addr, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${addr.slice(0,6)}...${addr.slice(-4)}</td>
        <td>${scores[i]}</td>
      `;
      tbody.appendChild(tr);
    });

    // üî• KIRIM KE app.js (INI YANG SEBELUMNYA HILANG)
    window.parent.postMessage({
      type: "leaderboardData",
      jackpot: jackpot,
      topScore: top
    }, "*");

  } catch (e) {
    console.error("Leaderboard error:", e);
    document.getElementById("leaderRows").innerHTML =
      "<tr><td colspan='3'>Failed to load</td></tr>";
  }
}

loadLeaderboard();
</script>

</body>
</html>
