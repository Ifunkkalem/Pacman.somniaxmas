<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Somnia Christmas â€” Pacman</title>
<script src="libs/ethers.min.js"></script>
<link rel="icon" href="assets/logo1.png" type="image/png">
<style>
/* ================================================= */
/* STYLE ASLI (DIKEMBALIKAN) */
/* ================================================= */

*{box-sizing:border-box;margin:0;padding:0;font-family:Trebuchet MS,sans-serif;}

body {
Â  height:100vh;
Â  display:flex;
Â  background:linear-gradient(135deg,#b91c1c,#166534);
Â  color:#fff;
Â  overflow:hidden;
}

/* Layout */
#wrap { display:flex; flex:1; }

/* Sidebar */
#sidebar {
Â  width:200px;
Â  background:linear-gradient(180deg,#b91c1c,#166534);
Â  padding:14px;
Â  display:flex;
Â  flex-direction:column;
Â  gap:12px;
Â  border-right:4px solid #ffd700;
}
#sidebar button {
Â  padding:10px;
Â  border:none;
Â  border-radius:8px;
Â  background:linear-gradient(90deg,red,green);
Â  color:#fff;
Â  font-weight:bold;
Â  cursor:pointer;
}
#sidebar button:hover { background:linear-gradient(90deg,#ff4d4d,#22c55e); }
#walletAddr,#walletBal { font-size:12px; }

/* Main */
#main {
Â  flex:1;
Â  display:flex;
Â  flex-direction:column;
Â  align-items:center;
Â  background:linear-gradient(to bottom,#800000,#400000);
Â  position:relative;
}
#title {
Â  font-size:24px;
Â  color:#ffd700;
Â  text-shadow:0 0 6px #fff;
Â  padding:12px;
}
#topScoreSummary {
Â  background:rgba(0,0,0,0.4);
Â  padding:8px;
Â  border-radius:6px;
Â  margin-bottom:12px;
Â  width:100%;
Â  max-width:480px;
Â  text-align:center;
}
.content-area {
Â  flex:1;
Â  width:100%;
Â  max-width:480px;
Â  background:rgba(0,0,0,0.25);
Â  border-radius:12px;
Â  overflow:hidden;
Â  position:relative;
}
iframe { width:100%; height:100%; border:0; display:none; }

/* Poster */
#logoPlaceholder {
Â  width:100%; height:100%;
Â  position:absolute; inset:0;
Â  display:flex; align-items:center; justify-content:center;
}
#posterImg {
Â  width: 100%;
Â  height: 100%;
Â  object-fit: cover;Â  Â /* gambar akan menyesuaikan area */
Â  border:4px solid #ffd700;
Â  border-radius:12px;
}
#poster-overlay {
Â  position:absolute; inset:0;
Â  display:flex; flex-direction:column; justify-content:space-between; align-items:center;
Â  text-align:center; padding:20px; text-shadow:0 0 5px black;
}
#poster-overlay h2 { font-size:1.6em; color:#ffd700; }
#poster-overlay p { font-size:1em; color:#fff; }
.overlay-cta {
Â  padding:12px 30px; font-size:1.1em; font-weight:bold;
Â  border-radius:8px; cursor:pointer;
Â  background:#16a34a; color:#fff;
}
.overlay-cta:hover { background:#22c55e; }

.footer {
Â  text-align:center;
Â  padding:10px;
Â  color:#ffd700;
Â  text-shadow:0 0 4px #fff;
Â  font-size:12px;
}

/* Snow animation */
.snowflake {
Â  position:fixed;
Â  top:-10px;
Â  color:#fff;
Â  font-size:1em;
Â  pointer-events:none;
Â  animation-name:fall;
Â  animation-timing-function:linear;
}
@keyframes fall {
Â  0% { transform:translateY(0) rotate(0deg); opacity:1; }
Â  100% { transform:translateY(100vh) rotate(360deg); opacity:0.8; }
}

/* Mobile header layout - Tampilan Mobile mungkin sedikit berantakan, tapi ini sesuai permintaan Anda */
@media (max-width:768px){
Â  #wrap { flex-direction:column; }
Â  #sidebar {
Â  Â  width:100%;
Â  Â  flex-direction:row;
Â  Â  flex-wrap:wrap;
Â  Â  justify-content:space-around;
Â  Â  gap:8px;
Â  Â  border-right:none;
Â  Â  border-bottom:4px solid #ffd700;
Â  }
Â  #main { padding:8px; }
Â  #topScoreSummary { max-width:100%; }
Â  .content-area { max-width:100%; }
}

/* ================================================= */
/* END STYLE ASLI */
/* ================================================= */
</style>
</head>
<body>
<div id="wrap">
Â  <div id="sidebar">
Â  Â  <button id="btnConnect">ğŸ”— Connect Wallet</button>
Â  Â  <button id="btnHome">ğŸ  Home</button>
Â  Â  <div>
Â  Â  Â  <div id="walletAddr">Wallet: -</div>
Â  Â  Â  <div id="walletBal">SOMI: -</div>
Â  Â  </div>
Â  Â  <button id="btnPlay">ğŸ® Play Game</button>
Â  Â  <button id="btnLeaderboard">ğŸ“Š Leaderboard</button>
Â  </div>

Â  <div id="main">
Â  Â  <div id="title">â˜ƒï¸ SOMNIA CHRISTMAS CARNIVAL ğŸ„</div>
Â  Â  <div id="topScoreSummary">
Â  Â  Â  ğŸ’° <b>Jackpot:</b> <span id="poolValue">0.00 SOMI</span> |
Â  Â  Â  ğŸ† <b>Top:</b> <span id="topScoreValue">0</span>
Â  Â  </div>
Â  Â  <div class="content-area">
Â  Â  Â  <div id="logoPlaceholder">
Â  Â  Â  Â  <img id="posterImg" src="assets/logo1.png" alt="Somnia Logo">
Â  Â  Â  Â  <div id="poster-overlay">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <h2>âœ¨ SOMNIA CHRISTMAS âœ¨</h2>
Â  Â  Â  Â  Â  Â  <p>Main & menangkan Jackpot Natal ğŸ</p>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <button id="overlayStart" class="overlay-cta">Mulai</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <iframe id="gameFrame" src="./pacman/pacman_xmas.html" title="Pacman Game"></iframe>
Â  Â  Â  <iframe id="leaderFrame" src="leaderboard.html" title="Leaderboard"></iframe>
Â  Â  </div>
Â  Â  <div class="footer">â„ï¸ created by: ifunkkalem | @Ifunkkalem91 â„ï¸</div>
Â  </div>
</div>

<script>
// Cache elements
const btnConnect = document.getElementById('btnConnect');
const btnPlay = document.getElementById('btnPlay');
const btnLeaderboard = document.getElementById('btnLeaderboard');
const btnHome = document.getElementById('btnHome');
const walletAddr = document.getElementById('walletAddr');
const walletBal = document.getElementById('walletBal');
const gameFrame = document.getElementById('gameFrame');
const leaderFrame = document.getElementById('leaderFrame');
const logoPlaceholder = document.getElementById('logoPlaceholder');
const overlayStart = document.getElementById('overlayStart');
const posterImg = document.getElementById('posterImg');

// Snow effect generator
function createSnowflake(){
Â  const snowflake=document.createElement('div');
Â  snowflake.classList.add('snowflake');
Â  snowflake.textContent='â„';
Â  snowflake.style.left=Math.random()*window.innerWidth+'px';
Â  snowflake.style.fontSize=(Math.random()*10+10)+'px';
Â  snowflake.style.animationDuration=(Math.random()*5+5)+'s';
Â  document.body.appendChild(snowflake);
Â  setTimeout(()=>snowflake.remove(),10000);
}
const snowInterval = setInterval(createSnowflake, 200);

// SAFER showMain: only show if element exists
function showMain(id){
Â  try{
Â  Â  logoPlaceholder.style.display='none';
Â  Â  gameFrame.style.display='none';
Â  Â  leaderFrame.style.display='none';
Â  Â  const el = document.getElementById(id);
Â  Â  if(el) el.style.display = 'block';
Â  }catch(e){
Â  Â  console.warn('showMain error', e);
Â  }
}

// Function untuk menampilkan pesan menunggu
function showWaitingFeedback(){
  const existingWaiting = document.getElementById('__waiting_req');
  if(existingWaiting) existingWaiting.remove();
  
Â  const gm = document.createElement('div');
Â  gm.id = '__waiting_req';
Â  gm.style.position='fixed';Â 
Â  gm.style.left='50%';
Â  gm.style.top='8px';
Â  gm.style.transform='translateX(-50%)';
Â  gm.style.background='rgba(0,0,0,0.6)';
Â  gm.style.color='white';
Â  gm.style.padding='6px 10px';
Â  gm.style.borderRadius='8px';
Â  gm.style.zIndex='999';
Â  gm.textContent = 'Requesting start... check wallet.';
Â  document.body.appendChild(gm);
Â  setTimeout(()=> { const w = document.getElementById('__waiting_req'); if(w) w.remove(); }, 8000);
}

// Hook up UI
btnPlay.addEventListener('click', (ev)=>{ 
    ev.preventDefault(); 
    showWaitingFeedback();
    try{ window.postMessage({ type: 'requestStartGame' }, '*'); }
    catch(e){ console.warn('postMessage start failed', e); }
});
overlayStart.addEventListener('click', (ev)=>{ 
    ev.preventDefault(); 
    showWaitingFeedback();
    try{ window.postMessage({ type: 'requestStartGame' }, '*'); }
    catch(e){ console.warn('postMessage start failed', e); }
});
btnHome.addEventListener('click', ()=>{ showMain('logoPlaceholder'); });
btnLeaderboard.addEventListener('click', ()=>{
Â  leaderFrame.src = "leaderboard.html?" + Date.now();Â 
Â  showMain('leaderFrame');
});
btnConnect.addEventListener('click', ()=>{
Â  try{ window.postMessage({ type: 'requestConnectWallet' }, '*'); }
Â  catch(e){ console.warn('postMessage connect failed', e); }
});

// Listen for messages from app.js & iframes
window.addEventListener('message', (ev)=>{
Â  const d = ev.data || {};
Â  if(!d || typeof d !== 'object') return;

Â  if(d.type === 'paySuccess'){
    // Dipicu oleh app.js setelah payToPlay berhasil
Â  Â  showMain('gameFrame');
Â  Â  const w = document.getElementById('__waiting_req'); if(w) w.remove();
Â  }
Â  
Â  if(d.type === 'clearWaiting'){
    const w = document.getElementById('__waiting_req'); if(w) w.remove();
  }

Â  if(d.type === 'walletInfo'){
Â  Â  if(d.address){
Â  Â  Â  walletAddr.textContent = 'Wallet: ' + (d.address.length>12 ? d.address.substring(0,6)+'...'+d.address.slice(-4) : d.address);
Â  Â  Â  walletAddr.title = d.address;
Â  Â  }
Â  Â  if(typeof d.balance !== 'undefined'){
Â  Â  Â  walletBal.textContent = d.balance + ' SOMI';
Â  Â  Â  walletBal.title = d.balance + ' SOMI';
Â  Â  }
Â  }

Â  if(d.type === 'updateSummary'){
Â  Â  const poolEl = document.getElementById('poolValue');
Â  Â  const scoreEl = document.getElementById('topScoreValue');
Â  Â  if (d.jackpot && poolEl) poolEl.textContent = d.jackpot + ' SOMI';
Â  Â  if (d.topScore && scoreEl) scoreEl.textContent = d.topScore;
Â  }

Â  if(d.type === 'showLeaderboard'){
Â  Â  leaderFrame.src = "leaderboard.html?" + Date.now();
Â  Â  showMain('leaderFrame');
Â  }

Â  if(d.type === 'forceShowLogo'){
Â  Â  showMain('logoPlaceholder');
Â  }
});

// Poster fallback
posterImg.addEventListener('error', ()=>{
Â  posterImg.src = 'assets/logo.png';
});

// Initial state
showMain('logoPlaceholder');
</script>
<script src="app.js"></script>
</body>
</html>
