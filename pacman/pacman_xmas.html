<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pacman XMAS - 4 Ghosts Sprite Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  html,body{ margin:0; background:#020617; height:100%; display:flex; justify-content:center; align-items:center; font-family: sans-serif; overflow: hidden; }
  #gameWrapper{ display:flex; flex-direction:column; align-items:center; gap:10px; }
  canvas{ background:#000; border: 3px solid #334155; border-radius:10px; box-shadow: 0 0 30px rgba(255,255,255,0.1); }
  #ui{ color:#ffd700; font-size: 20px; font-weight: bold; width: 100%; display: flex; justify-content: space-between; padding: 5px; box-sizing: border-box; }
</style>
</head>
<body>

<div id="gameWrapper">
    <div id="ui">
        <span>ðŸŽ… Score: <span id="score">0</span></span>
        <span id="power-status" style="color: #60a5fa; display: none; font-weight: bold;">POWER UP!</span>
    </div>
    <canvas id="pacman-canvas"></canvas>
</div>

<script>
(() => {
const TILE = 28; // Ukuran sedikit diperbesar agar sprite terlihat jelas
const canvas = document.getElementById("pacman-canvas");
const ctx = canvas.getContext("2d");

/* --- KONFIGURASI GITHUB SPRITE --- */
// GANTI URL DI BAWAH INI DENGAN URL REPO ANDA
const GITHUB_BASE = "https://raw.githubusercontent.com/Ifunkkalem/Pacman.somniaxmas/main/"; 

const sprites = {
    santa: new Image(),
    ghost1: new Image(),
    ghost2: new Image(),
    ghost3: new Image(),
    ghost4: new Image(),
    scared: new Image() // Opsional: Rusa biru saat ketakutan
};

// Masukkan nama file PNG Anda di sini
sprites.santa.src = GITHUB_BASE + "santa.png";
sprites.ghost1.src = GITHUB_BASE + "rudolph.png";
sprites.ghost2.src = GITHUB_BASE + "vixen.png";
sprites.ghost3.src = GITHUB_BASE + "dancer.png";
sprites.ghost4.src = GITHUB_BASE + "dasher.png";
sprites.scared.src = GITHUB_BASE + "kelinci.png";

const MAP = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,3,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,3,1],
    [1,2,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,2,1],
    [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
    [1,2,1,1,2,1,2,1,1,1,1,1,2,1,2,1,1,2,1],
    [1,2,2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,2,1],
    [1,1,1,1,2,1,1,1,0,1,0,1,1,1,2,1,1,1,1],
    [0,0,0,1,2,1,0,0,0,0,0,0,0,1,2,1,0,0,0],
    [1,1,1,1,2,1,0,1,1,1,1,1,0,1,2,1,1,1,1],
    [1,2,2,2,2,2,2,1,0,0,0,1,2,2,2,2,2,2,1],
    [1,1,1,1,2,1,0,1,1,1,1,1,0,1,2,1,1,1,1],
    [1,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,1],
    [1,3,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,3,1],
    [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

let mapData = MAP.map(row => [...row]);
let pacman = { x: 9, y: 9, dir: "right", next: "right", power: 0 };

// 4 Ghosts dengan Sprite berbeda
let ghosts = [
    { x: 8, y: 7, img: sprites.ghost1, scared: false, startX: 8, startY: 7 },
    { x: 9, y: 7, img: sprites.ghost2, scared: false, startX: 9, startY: 7 },
    { x: 10, y: 7, img: sprites.ghost3, scared: false, startX: 10, startY: 7 },
    { x: 9, y: 8, img: sprites.ghost4, scared: false, startX: 9, startY: 8 }
];

let score = 0;
let gameRunning = true;

/* --- DRAWING SPRITES --- */
function drawSanta() {
    const px = pacman.x * TILE;
    const py = pacman.y * TILE;
    
    // Jika gambar sudah terload, gambar sprite, jika belum gambar lingkaran
    if (sprites.santa.complete) {
        ctx.drawImage(sprites.santa, px, py, TILE, TILE);
    } else {
        ctx.fillStyle = "red";
        ctx.beginPath(); ctx.arc(px + TILE/2, py + TILE/2, TILE/2 - 2, 0, Math.PI*2); ctx.fill();
    }
}

function drawGhost(g) {
    const gx = g.x * TILE;
    const gy = g.y * TILE;
    
    let currentImg = g.img;
    if (g.scared) {
        currentImg = sprites.scared.complete ? sprites.scared : g.img;
        ctx.globalAlpha = 0.7; // Efek transparan saat takut
    }

    if (currentImg.complete) {
        ctx.drawImage(currentImg, gx, gy, TILE, TILE);
    } else {
        // Fallback jika GitHub belum respon
        ctx.fillStyle = "blue";
        ctx.fillRect(gx+4, gy+4, TILE-8, TILE-8);
    }
    ctx.globalAlpha = 1.0;
}

/* --- GAME LOGIC --- */
function update() {
    if(!gameRunning) return;

    // Movement Santa
    let nx = pacman.x + (pacman.next === "right" ? 1 : pacman.next === "left" ? -1 : 0);
    let ny = pacman.y + (pacman.next === "down" ? 1 : pacman.next === "up" ? -1 : 0);

    if(mapData[ny] && mapData[ny][nx] !== 1) {
        pacman.x = nx; pacman.y = ny; pacman.dir = pacman.next;
        if(mapData[ny][nx] === 2) { mapData[ny][nx] = 0; score += 10; }
        if(mapData[ny][nx] === 3) { mapData[ny][nx] = 0; score += 50; activatePower(); }
    }

    // Power Timer
    if(pacman.power > 0) {
        pacman.power--;
        if(pacman.power === 0) ghosts.forEach(g => g.scared = false);
    }

    // Ghosts AI
    ghosts.forEach(g => {
        const dirs = [[1,0], [-1,0], [0,1], [0,-1]];
        const valid = dirs.filter(d => mapData[g.y + d[1]][g.x + d[0]] !== 1);
        const move = valid[Math.floor(Math.random() * valid.length)];
        g.x += move[0]; g.y += move[1];

        if(g.x === pacman.x && g.y === pacman.y) {
            if(g.scared) {
                score += 200;
                g.x = g.startX; g.y = g.startY;
                g.scared = false;
            } else {
                gameRunning = false;
                alert("GAME OVER! Skor: " + score);
                location.reload();
            }
        }
    });
    document.getElementById("score").textContent = score;
}

function activatePower() {
    pacman.power = 50; 
    ghosts.forEach(g => g.scared = true);
    document.getElementById("power-status").style.display = "inline";
    setTimeout(() => { if(pacman.power <= 0) document.getElementById("power-status").style.display = "none"; }, 5000);
}

function draw() {
    ctx.clearRect(0,0,canvas.width, canvas.height);
    
    // Draw Labirin Es
    for(let y=0; y<mapData.length; y++){
        for(let x=0; x<mapData[y].length; x++){
            if(mapData[y][x] === 1) {
                ctx.fillStyle = "#1e3a8a"; // Biru gelap salju
                ctx.fillRect(x*TILE, y*TILE, TILE, TILE);
                ctx.strokeStyle = "#3b82f6";
                ctx.strokeRect(x*TILE, y*TILE, TILE, TILE);
            } else if(mapData[y][x] === 2) {
                ctx.fillStyle = "white";
                ctx.beginPath(); ctx.arc(x*TILE+TILE/2, y*TILE+TILE/2, 2, 0, Math.PI*2); ctx.fill();
            } else if(mapData[y][x] === 3) {
                // Bintang Emas
                ctx.fillStyle = "#fbbf24";
                ctx.beginPath(); ctx.arc(x*TILE+TILE/2, y*TILE+TILE/2, 6, 0, Math.PI*2); ctx.fill();
            }
        }
    }

    drawSanta();
    ghosts.forEach(drawGhost);
}

function loop() {
    update();
    draw();
    setTimeout(() => requestAnimationFrame(loop), 200);
}

// Input
window.addEventListener("keydown", (e) => {
    if(e.key === "ArrowUp") pacman.next = "up";
    if(e.key === "ArrowDown") pacman.next = "down";
    if(e.key === "ArrowLeft") pacman.next = "left";
    if(e.key === "ArrowRight") pacman.next = "right";
});

canvas.width = mapData[0].length * TILE;
canvas.height = mapData.length * TILE;
loop();
})();
</script>
</body>
</html>
